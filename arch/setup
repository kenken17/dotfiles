# Enable bluetooth
systemctl start bluetooth
systemctl enable bluetooth

# Install LTS
pacman -S linux-lts linux-lts-headers
grub-mkconfig -o /boot/grub/grub.cfg

# Firewall
pacman -S ufw
ufw enable
systemctl enable ufw.service

# Remove unuse packages
pacman -Rns $(pacman -Qtdq)

# Optimize pacman DB
pacman-optimize

# Check for errors
systemctl --failed

journalctl -p 3 -xb

# Remove broken yay package
yay -Yc

# Add in AUR helper yay
git clone https://aur.archlinux.org/yay.git
cd yay
makepkg -si

# Install Google
yay google-chrome

# NodeJS and NPM
pacman -S nodejs npm

# For suod issue
mkdir ~/.npm-global

# Configure npm to use the new directory path:
npm config set prefix '~/.npm-global'

# open /.bashrc file and add this line:
export PATH=~/.npm-global/bin:$PATH

# Tmux
pacman -S tmux

# Oh My Tmux
cd
git clone https://github.com/gpakosz/.tmux.git
ln -s -f .tmux/.tmux.conf

# Add in plugin
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Git
git config --global user.name "ken"
git config --global user.email kenken17@gmail.com

# GitKraken
yay -S gitkraken

# JDK
yay -S jdk

# Virtual box
pacman -S virtualbox (use *-arch)

# Chinese IME
pacman -S ibus-libpinyin

# CJK Font
pacman -S adobe-source-han-serif-otc-fonts
pacman -S adobe-source-han-sans-otc-fonts

# Nerd Font
yay -S nerd-fonts-complete

# Reflector for mirrolist
pacman -S reflector
reflector -c Singapore -c Malaysia -c Taiwan -a 12 -p https --sort rate --save /etc/pacman.d/mirrorlist

# Add in service for reflector
sudo vim /etc/systemd/system/reflector.service

Add in:
  [Unit]
  Description=Pacman update mirrolist
  Wants=network-online.target
  After=network-online.target

  [Service]
  Type=oneshot
  ExecStart=/usr/bin/reflector -c Singapore -c Malaysia -c Taiwan -a 12 -p https --sort rate --save /etc/pacman.d/mirrorlist

  [Install]
  RequiredBy=multi-user.target

# Add in timer for reflector
sudo vim /etc/systemd/system/reflector.timer

Add in:
  [Unit]
  Description=Pacman update mirrolist timer

  [Timer]
  OnCalendar=Mon *-*-* 7:00:00
  RandomizeDelaySec=15h
  Persistent=true

  [Install]
  WantedBy=timers.target

# Add in fs trim timer for SSD
  systemctl enable fstrim.timer

# Install Anti Virus - clamav
pacman -S clamav

systemctl start clamav-daemon
system enable clamav-daemon

freshclam (sudo)

system start clamav-freshclam
system enable clamav-freshclam

# Add in on access scan, first check the notification setup
zgrep FANOTIFY /proc/config.gz

# Set the on access scan
sudo vim /etc/clamav/clamd.conf

# Add in:
  # Enables on-access scan, requires clamav-daemon.service running
  ScanOnAccess yes

  # Set the mount point where to recursively perform the scan,
  # this could be every path or multiple path (one line for path)
  OnAccessMountPath /usr
  OnAccessMountPath /home/
  OnAccessExcludePath /var/log/

  # Flag fanotify to block any events on monitored files to perform the scan
  OnAccessPrevention no

  # Perform scans on newly created, moved, or renamed files
  OnAccessExtraScanning yes

  # Check the UID from the event of fanotify
  OnAccessExcludeUID 0

  # Specify an action to perform when clamav detects a malicious file
  # it is possible to specify an inline command too
  VirusEvent /etc/clamav/detected.sh

  # WARNING: clamd should run as root
  User root

# For the detect script
sudo vim /etc/clamav/detected.sh

# Add in:
  #!/bin/bash
  PATH=/usr/bin
  alert="Signature detected: $CLAM_VIRUSEVENT_VIRUSNAME in $CLAM_VIRUSEVENT_FILENAME"

  # Send the alert to systemd logger if exist, othewise to /var/log
  if [[ -z $(command -v systemd-cat) ]]; then
          echo "$(date) - $alert" >> /var/log/clamav/detections.log
  else
          # This could cause your DE to show a visual alert. Happens in Plasma, but the next visual alert is much nicer.
          echo "$alert" | /usr/bin/systemd-cat -t clamav -p emerg
  fi

  # Send an alert to all graphical users.
  XUSERS=($(who|awk '{print $1$NF}'|sort -u))

  for XUSER in $XUSERS; do
      NAME=(${XUSER/(/ })
      DISPLAY=${NAME[1]/)/}
      DBUS_ADDRESS=unix:path=/run/user/$(id -u ${NAME[0]})/bus
      echo "run $NAME - $DISPLAY - $DBUS_ADDRESS -" >> /tmp/testlog 
      /usr/bin/sudo -u ${NAME[0]} DISPLAY=${DISPLAY} \
                         DBUS_SESSION_BUS_ADDRESS=${DBUS_ADDRESS} \
                         PATH=${PATH} \
                         /usr/bin/notify-send -i dialog-warning "clamAV" "$alert"
  done

# Install the WIFI adaptor driver
yay -S rtl88x2bu-dkms-git
